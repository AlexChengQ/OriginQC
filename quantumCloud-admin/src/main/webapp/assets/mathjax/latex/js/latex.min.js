function CCgetId(n){return document.getElementById(n)}function CConchange(n,fn){var a=CCgetId(n);if(a)a.onchange=fn}function CConclick(n,fn){var a=CCgetId(n);if(a)a.onclick=fn}function setadvert(){var e=CCgetId('latex_formula');var x=e.offsetWidth;if(CCgetId('wrap').style.marginLeft=='auto')x-=170;CCgetId('advert').style.display=(x<600?'none':'block');CCgetId('wrap').style.marginLeft=(x<600?'auto':'170px')}var nocookies=false;var Cookie={set:function(c_name,value,expiredays){if(nocookies)return;{var exdate=new Date();exdate.setDate(exdate.getDate()+expiredays);document.cookie=c_name+"="+escape(value)+((expiredays==null)?"":";expires="+exdate.toGMTString())}},get:function(c_name){if(document.cookie.length>0){c_start=document.cookie.indexOf(c_name+"=");if(c_start!=-1){c_start=c_start+c_name.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1)c_end=document.cookie.length;return unescape(document.cookie.substring(c_start,c_end))}}return''}};var Panel={plock:null,ctimer:null,otimer:null,oid:null,timer:Array(),open:function(a){if(a){var id=a.id;if(this.timer[id]!=''){clearTimeout(this.timer[id]);this.timer[id]=''}this.timer[id]=setTimeout("CCgetId('"+id+"').style.overflow='visible';",200)}},close:function(a){if(a){var id=a.id;if(this.timer[id]!=''){clearTimeout(this.timer[id]);this.timer[id]=''}this.timer[id]=setTimeout("CCgetId('"+id+"').style.overflow='hidden';",200)}},init:function(hoverbox,editorid){this.hoverdiv=CCgetId(hoverbox);var divElem;if(editorid!==undefined)divElem=document.getElementById(editorid);else divElem=document;var areas=divElem.getElementsByTagName('area');for(i=0;i<areas.length;i++){latex=areas[i].alt;areas[i].latex=latex;areas[i].alt='';if(areas[i].title=='')areas[i].title=latex;if(areas[i].onclick==undefined)areas[i].onclick=function(){EqEditor.insert(this.latex)}}if(divElem.getElementsByClassName==undefined){divElem.getElementsByClassName=function(className){var hasClassName=new RegExp("(?:^|\\s)"+className+"(?:$|\\s)");var allElements=divElem.getElementsByTagName("*");var results=[];var element;for(var i=0;(element=allElements[i])!=null;i++){var elementClass=element.className;if(elementClass&&elementClass.indexOf(className)!=-1&&hasClassName.test(elementClass))results.push(element)}return results}}var panels=divElem.getElementsByClassName('panel');for(i=0;i<panels.length;i++)if(panels[i].id!=''){panels[i].onmouseover=function(e){Panel.open(this)};panels[i].onmouseout=function(e){Panel.close(this)}}}};function EqTextArea(preview,input,comment,download,intro){this.changed=false;this.orgtxt='';this.bArray_id=new Array();this.bArray_area=new Array();this.bArray_mode=new Array();this.bsize=0;this.updateExportArea=function(){for(i=0;i<this.bsize;i++){var v=this.exportEquation(this.bArray_mode[i]);if(this.bArray_area[i].src!==undefined)this.bArray_area[i].src=v;else if(this.bArray_area[i].value!==undefined)this.bArray_area[i].value=v;else if(this.bArray_area[i].innerHTML!==undefined)this.bArray_area[i].innerHTML=v}};this.addExportArea=function(textarea_id,mode){var a=CCgetId(textarea_id);if(a){this.bArray_id[this.bsize]=textarea_id;this.bArray_area[this.bsize]=a;this.bArray_mode[this.bsize]=mode;this.bsize++}};this.changeExportArea=function(textarea_id,mode){for(i=0;i<this.bsize;i++){if(textarea_id==this.bArray_id[i]){this.bArray_mode[i]=mode;i=this.bsize}}};this.myUndo=0;this.myRedo=0;this.store_text=new Array();this.store_text.push("");this.addEvent=function(action,fn){if(this.equation_input.addEventListener)this.equation_input.addEventListener(action,fn,false);else this.equation_input.attachEvent('on'+action,fn)};this.set=function(preview,input,comment,download,intro){if(preview==undefined||preview=='')preview='equationview';if(input==undefined||input=='')input='latex_formula';if(comment==undefined||comment=='')comment='equationcomment';if(intro==undefined||intro=='')intro='intro';this.equation_preview=CCgetId(preview);this.equation_input=CCgetId(input);this.equation_comment=CCgetId(comment);this.intro_text=intro};this.setText=function(val){var latex=unescape(val.replace(/\&space;/g,' ').replace(/\&plus;/g,'+').replace(/\&hash;/g,'#').replace(/\@plus;/g,'+').replace(/\@hash;/g,'#'));EqEditor.reset();var i,subtex,go;do{go=0;latex=latex.replace(new RegExp("^[\\s]+","g"),"");i=latex.indexOf(' ');var ii=latex.indexOf('}');if(ii!=-1&&(ii<i||i==-1))i=ii;if(i!=-1){subtex=latex.substr(0,i);if(EqEditor.setSelIndx('fontsize',subtex))go=1;if(subtex=='\\inline'){CCgetId('inline').checked=true;CCgetId('compressed').checked=true;go=1}if(subtex.substr(0,4)=='\\bg_'&&EqEditor.setSelIndx('bg',subtex.substr(4)))go=1;if(subtex.substr(0,4)=='\\fn_'&&EqEditor.setSelIndx('font',subtex.substr(4)))go=1;if(subtex.substr(0,5)=='\\dpi{'&&EqEditor.setSelIndx('dpi',subtex.substr(5)))go=1;if(go)latex=latex.substr(i+1)}}while(go)if(latex.length>0){this.equation_input.value=latex}};this.clearText=function(){this.equation_input.value="";this.equation_input.focus();this.changed=false};this.auton=0;this.renderCountdown=function(){if(this.auton>0){this.auton--;var fn=new Function(this.renderCountdown());setTimeout(fn,100)}};this.autorenderEqn=function(n){if(this.auton>0&&n>0)this.auton=n;else{this.auton=n;this.renderCountdown()}};this.insertText=function(txt,pos,inspos){var key_text='';if(pos==1000){pos=txt.length-1}if(pos==null){pos=txt.indexOf('{')+1;if(pos<=0){txt+=' ';pos=txt.length}else{if(txt.charAt(pos)!='}')pos=txt.indexOf('}',pos)+1}}var insert_pos=(inspos==null)?pos:inspos;var i;var myField=this.equation_input;var leftbracket=(txt.substring(1,5)=="left");if(document.selection){myField.focus();var sel=document.selection.createRange();i=this.equation_input.value.length+1;var theCaret=sel.duplicate();while(theCaret.parentElement()==myField&&theCaret.move("character",1)==1)--i;if((leftbracket||insert_pos>=0)&&sel.text.length){if(leftbracket)ins_point=7;else ins_point=insert_pos;if(insert_pos==null)pos=txt.length+sel.text.length+1;else if(insert_pos<pos)pos+=sel.text.length;sel.text=txt.substring(0,ins_point)+sel.text+txt.substr(ins_point)}else sel.text=txt;var range=myField.createTextRange();range.collapse(true);pos=i+pos;pos-=myField.value.substr(0,pos).split("\n").length-1;range.moveEnd('character',pos);range.moveStart('character',pos);range.select()}else{if(myField.selectionStart||myField.selectionStart=='0'){var startPos=myField.selectionStart;var endPos=myField.selectionEnd;var cursorPos=startPos+txt.length;if((leftbracket||insert_pos>=0)&&endPos>startPos){if(leftbracket)ins_point=7;else ins_point=insert_pos;if(insert_pos==null)pos=txt.length+endPos-startPos+1;else if(insert_pos<pos)pos+=endPos-startPos;txt=txt.substring(0,ins_point)+myField.value.substring(startPos,endPos)+txt.substr(ins_point)}myField.value=myField.value.substring(0,startPos)+txt+myField.value.substring(endPos,myField.value.length);myField.selectionStart=cursorPos;myField.selectionEnd=cursorPos;myField.focus();myField.setSelectionRange(startPos+pos,startPos+pos)}else myField.value+=txt}this.autorenderEqn(10);Panel.close(null);myField.focus()};this.getLaTeX=function(){var a=this.equation_input.value.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ");if(a.length>0)return EqEditor.getSize()+a;return''};this.getEquationStr=function(){var a=this.getLaTeX();if(a.length>0)return EqEditor.getCompressed()+EqEditor.getDPI()+EqEditor.getBG()+EqEditor.getFont()+a;return''};this.exportMessage=function(text){var a=CCgetId('exportmessage');if(a)a.innerHTML=text};this.setcomment=function(text){if(this.equation_comment)this.equation_comment.innerHTML=text};this.clickval=0;this.undo=function(box){if(this.myRedo==0){if(this.myUndo>20)this.store_text.shift();else this.myUndo++;this.store_text[this.myUndo]=this.equation_input.value}z=this.store_text.length-this.myRedo-1;if(this.store_text[z])this.equation_input.value=this.store_text[z];else this.equation_input.value=this.store_text[0];this.equation_input.focus()};this.redo=function(box){var z=this.store_text.length-this.myRedo-1;if(this.store_text[z])this.equation_input.value=this.store_text[z];else this.equation_input.value=this.store_text[0];this.equation_input.focus()};this.Export=function(fnobj,type){Example.add_history(this.equation_input.value);Example.hide();fnobj(this.exportEquation(type))};this.load=function(val){if(typeof val!=='undefined')this.setText(val)};if(preview!==undefined)this.set(preview,input,comment,download,intro)};var gallery=null;var ExportButton={bArray_id:new Array(),bArray_area:new Array(),bArray_mode:new Array(),bArray_fn:new Array(),bsize:0,state:function(state){for(i=0;i<this.bsize;i++){if(state)this.bArray_id[i].className='lightbluebutton';else this.bArray_id[i].className='greybutton'}},add:function(textarea,button_id,targetFn,mode){var a=CCgetId(button_id);if(a){this.bArray_id[this.bsize]=a;this.bArray_area[this.bsize]=textarea;this.bArray_mode[this.bsize]=mode;this.bArray_fn[this.bsize]=targetFn;a.onclick=function(e){var i=this.exportid;ExportButton.bArray_area[i].Export(ExportButton.bArray_fn[i],ExportButton.bArray_mode[i]);window.close()};a.exportid=this.bsize;this.bsize++}}};var EqEditor={SID:0,copy_button:null,key_text:'',format:'gif',setSelIndx:function(id,v){var s=CCgetId(id);if(s)for(var i=0;i<s.options.length;i++){if(s.options[i].value==v){s.options[i].selected=true;return true}}return false},targetArray:new Array(),targetSize:0,targetArea:null,curTarget:0,changeExportArea:function(id,mode){for(i=0;i<this.targetSize;i++)this.targetArray[i].changeExportArea(id,mode)},autorenderEqn:function(n){this.targetArea.autorenderEqn(n)},change:function(i){if(i!=this.curTarget){this.curTarget=i;this.key_rext=''}this.targetArea=this.targetArray[i]},add:function(obj,resize){this.targetArray[this.targetSize]=obj;obj.equation_input.onfocus=new Function('EqEditor.change('+this.targetSize+');');if(resize){if(window.addEventListener)window.addEventListener('resize',new Function('EqEditor.resize('+this.targetSize+');'),false);else window.attachEvent('onresize',new Function('EqEditor.resize('+this.targetSize+');'));EqEditor.resize(this.targetSize)}if(this.targetSize==0)obj.equation_input.focus();this.targetSize++},editor_id:null,embed:function(id,SID,design,language){if(this.targetSize>0){this.targetArray=new Array();this.targetSize=0;this.targetArea=null;this.curTarget=0}if(this.editor_id!=id){this.editor_id=id;var url=EMBED_ENGINE+'?id='+id+'&SID='+SID+'&design='+design;if(language!=undefined&&language!='')url+='&lang='+language;var fileref=document.createElement('script');fileref.setAttribute("type","text/javascript");fileref.setAttribute("src",url);document.getElementsByTagName("head")[0].appendChild(fileref)}},moveto:function(id){if(id!=this.editor_id){var newNode=CCgetId(id);while(CCgetId(this.editor_id).childNodes[0]){var oldNode=CCgetId(this.editor_id).childNodes[0];oldNode.parentNode.removeChild(oldNode);newNode.appendChild(oldNode)}this.editor_id=id}},init:function(SID,obj,resize,editorid){Panel.init('hover',editorid);if(SID==''){this.SID=Cookie.get('eqeditor');if(!this.SID){var d=new Date();this.SID=d.getTime();Cookie.set('eqeditor',SID,30)}}else this.SID=SID;if(obj!==undefined){this.add(obj,resize);this.targetArea=obj}this.setSelIndx('format',Cookie.get('format'));this.setSelIndx('font',Cookie.get('font'));this.setSelIndx('fontsize',Cookie.get('fontsize'));this.setSelIndx('dpi',Cookie.get('dpi'));this.setSelIndx('bg',Cookie.get('bg'));CConclick('undobutton',function(e){EqEditor.targetArea.undo()});CConclick('redobutton',function(e){EqEditor.targetArea.redo()});CConchange('bg',function(e){var b=CCgetId('bg');if(b){Cookie.set('bg',b.value,10)}EqEditor.update()});CConchange('dpi',function(e){var d=CCgetId('dpi');if(d){Cookie.set('dpi',d.value,10)}EqEditor.update()});CConchange('font',function(e){var f=CCgetId('font');if(f){Cookie.set('font',f.value,10)}EqEditor.update()});CConchange('format',function(e){var action=false;EqEditor.setFormat(EqEditor.getFormat())});CConchange('fontsize',function(){var f=CCgetId('fontsize');if(f){Cookie.set('fontsize',f.value,10)}EqEditor.update()});CConclick('inline',function(e){var a=CCgetId('compressed');if(a)a.checked=this.checked;EqEditor.update()});CConclick('compressed',function(e){EqEditor.update()})},load:function(txt){if(this.targetArea!=null)this.targetArea.load(txt)},insert:function(txt,pos,inspos){if(this.targetArea!=null){this.targetArea.insertText(txt,pos,inspos);ExportButton.state(true)}},getTextArea:function(){if(this.targetArea!=null)return this.targetArea;return null},clearText:function(){this.targetArea.clearText();ExportButton.state(false)},extendchar:null,tabHandler:function(e){var TABKEY=9;var inp=this.targetArea.equation_input;if(e.keyCode==TABKEY){if(document.selection){var sel=document.selection.createRange();i=inp.value.length+1;var theCaret=sel.duplicate();while(theCaret.parentElement()==inp&&theCaret.move("character",1)==1)--i;startPos=i;if(startPos==inp.value.length)return true}else{startPos=inp.selectionStart;if(startPos==inp.value.length)return true}var a=inp.value.indexOf('{',startPos);if(a==-1)a=inp.value.length;else a++;var b=inp.value.indexOf('&',startPos);if(b==-1)b=inp.value.length;else b++;var c=inp.value.indexOf('\\\\',startPos);if(c==-1)c=inp.value.length;else c+=2;var pos=Math.min(Math.min(a,b),c);if(document.selection){range=inp.createTextRange();range.collapse(true);pos-=inp.value.substr(0,pos).split("\n").length-1;range.moveEnd('character',pos);range.moveStart('character',pos);range.select()}else inp.setSelectionRange(pos,pos);if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false}},makeEquationsMatrix:function(type,isNumbered,isConditional){if(isNumbered===undefined)isNumbered=false;if(isConditional===undefined)isNumbered=false;eqns="\\begin{"+type+((isNumbered)?"":"*")+"}";eqi="\n &"+((isNumbered)?" ":"= ")+((isConditional)?"\\text{ if } x= ":"");eqEnd="\n\\end{"+type+((isNumbered)?"":"*")+"}";i=0;dim=prompt('输入行数：','');if(dim!=''&&dim!==null){n=parseInt(dim);if(!isNaN(n)){for(i=1;i<=n-1;i++)eqns=eqns+(eqi+"\\\\ ");eqns=(eqns+eqi)+eqEnd;this.insert(eqns,type.length+((isNumbered)?0:1)+9)}}},makeArrayMatrix:function(type,start,end){var matr=start+'\\begin{'+type+'matrix}';var row="\n";var mend="\n\\end{"+type+"matrix}"+end;var i=0;var dim=prompt('输入数组，以(英文)逗号分隔（举例：2行3列，输入“2,3”）','');if(dim!==''&&dim!==null){dim=dim.split(',');m=parseInt(dim[0]);n=parseInt(dim[1]);if(!isNaN(m)&&!isNaN(n)){for(i=2;i<=n;i++)row=row+' & ';for(i=1;i<=m-1;i++)matr=matr+row+'\\\\ ';matr=matr+row+mend;this.insert(matr,type.length+start.length+15)}}},resize:function(num){var x,y;if(self.innerHeight)y=self.innerHeight;else if(document.documentElement&&document.documentElement.clientHeight)y=document.documentElement.clientHeight;else if(document.body)y=document.body.clientHeight;this.targetArray[num].equation_input.style.height=parseInt(Math.max((y-200)/3,40))+'px'}};(function () {var QUEUE = MathJax.Hub.queue;var math = null, box = null;var HIDEBOX = function () {box.style.visibility = "hidden"};var SHOWBOX = function () {box.style.visibility = "visible"};QUEUE.Push(function () {math = MathJax.Hub.getAllJax("MathOutput")[0];box = document.getElementById("box");SHOWBOX(); });window.UpdateMath = function (TeX) {QUEUE.Push(HIDEBOX,["resetEquationNumbers",MathJax.InputJax.TeX],["Text",math,"\\displaystyle{"+TeX+"}"],SHOWBOX);var urlcode = TeX.replace(/\n/g,"%0d");var urlcode = urlcode.replace(/\s/g,"%20");document.getElementById("URLOutput").innerHTML="http://latex.91maths.com/p/?"+urlcode;}})();if (MathJax.Hub.Browser.isMSIE) {latex_formula.onkeypress = function () {if (window.event && window.event.keyCode === 13) {this.blur(); this.focus()}}}var a=new EqTextArea(''); EqEditor.init('Common',a,true);function show(obj,obj2){var obj=document.getElementById(obj); var obj2=document.getElementById(obj2); if(obj.style.display=="none"){obj.style.display="block";obj2.style.marginLeft="160px";document.getElementById("openClose").innerHTML = "关闭推荐";}else{obj.style.display="none";obj2.style.marginLeft="0px";document.getElementById("openClose").innerHTML = "打开推荐";}}var autoTextarea = function (elem, extra, maxHeight) {extra = extra || 0;var isFirefox = !!document.getBoxObjectFor || 'mozInnerScreenX' in window,isOpera = !!window.opera && !!window.opera.toString().indexOf('Opera'),addEvent = function (type, callback) {elem.addEventListener ?elem.addEventListener(type, callback, false) :elem.attachEvent('on' + type, callback);},getStyle = elem.currentStyle ? function (name) {var val = elem.currentStyle[name];if (name === 'height' && val.search(/px/i) !== 1) {var rect = elem.getBoundingClientRect();return rect.bottom - rect.top -	parseFloat(getStyle('paddingTop')) -	parseFloat(getStyle('paddingBottom')) + 'px';        };return val;} : function (name) {return getComputedStyle(elem, null)[name];},minHeight = parseFloat(getStyle('height'));elem.style.resize = 'none';var change = function () {var scrollTop, height,padding = 0,style = elem.style;if (elem._length === elem.value.length) return;elem._length = elem.value.length;if (!isFirefox && !isOpera) {padding = parseInt(getStyle('paddingTop')) + parseInt(getStyle('paddingBottom'));};scrollTop = document.body.scrollTop || document.documentElement.scrollTop;elem.style.height = minHeight + 'px';if (elem.scrollHeight > minHeight) {if (maxHeight && elem.scrollHeight > maxHeight) {height = maxHeight - padding;style.overflowY = 'auto';} else {height = elem.scrollHeight - padding;style.overflowY = 'hidden';};style.height = height + extra + 'px';scrollTop += parseInt(style.height) - elem.currHeight;document.body.scrollTop = scrollTop;document.documentElement.scrollTop = scrollTop;elem.currHeight = parseInt(style.height);};};addEvent('propertychange', change);addEvent('input', change);addEvent('focus', change);change();};var text = document.getElementById("latex_formula");autoTextarea(text);